<!DOCTYPE html>
<html>
<head>
    <title>Reddit Comments in Markdown</title>
    <style>
        body {
            background-color: #282a36;
            color: #f8f8f2;
            font-family: Arial, sans-serif;
        }
        #container {
            position: relative;
            width: 100%;
        }
        #output {
            width: 100%;
            height: 200px;
            resize: both;
            overflow: auto;
            max-width: 97vw;
            max-height: 100vh;
            background-color: #44475a;
            color: #f8f8f2;
            border: none;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
        }
        #copyButton {
            position: absolute;
            top: 25px;
            right: 10px;
            cursor: pointer;
            fill: #50fa7b;
        }
        input[type="text"], button {
            background-color: #44475a;
            color: #f8f8f2;
            border: none;
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-size: 1em;
        }
        input[type="text"] {
            width: calc(100% - 20px);
        }
        button {
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        button:hover {
            background-color: #6272a4;
        }
    </style>
</head>
<body>
    <input type="text" id="url" placeholder="Enter the Reddit post URL" aria-label="Enter the Reddit post URL">
    <button onclick="getComments()" aria-label="Get Comments">Get Comments</button>
    <div id="container">
        <textarea id="output"></textarea>
        <svg id="copyButton" onclick="copyToClipboard()" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
            <path d="M6 1a2 2 0 0 0-2 2v1H4a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1V3a2 2 0 0 0-2-2H6zm0 1h4v1H6V2z"/>
        </svg>
    </div>

    <script>
        // Create a MutationObserver instance
        const observer = new MutationObserver(updateButtonPosition);

        // Start observing the textarea for attribute changes
        observer.observe(document.getElementById('output'), { attributes: true });

        function updateButtonPosition() {
            const output = document.getElementById('output');
            const button = document.getElementById('copyButton');

            // Update the button's position
            button.style.top = (output.offsetTop + 10) + 'px';
            button.style.right = (output.offsetParent.offsetWidth - output.offsetWidth - output.offsetLeft + 10) + 'px';
        }

        async function getComments() {
            // Get the URL from the input field
            const url = document.getElementById('url').value + '.json';
            
            // Fetch the JSON data from the Reddit post
            const response = await fetch(url);
            const data = await response.json();
            
            // Get the list of comments
            const comments = data[1].data.children;
            
            let markdownOutput = '';
            
            // Recursive function to handle nested comments
            function parseComment(comment) {
                if (comment.kind === 't1') {  // t1 signifies a comment
                    const author = comment.data.author;
                    const body = comment.data.body;
                    
                    // Convert to Markdown (here, we're just adding bold formatting to the author name)
                    markdownOutput += `**${author}** : ${body}\n\n`;
                    
                    // Check for replies to the comment
                    if ('replies' in comment.data && comment.data.replies !== '') {
                        for (let reply of comment.data.replies.data.children) {
                            parseComment(reply);
                        }
                    }
                }
            }
            
            // Loop through the comments
            for (let comment of comments) {
                parseComment(comment);
            }
            
            // Output the comments in the textarea
            document.getElementById('output').value = markdownOutput;
        }

        function copyToClipboard() {
            // Select the text
            document.getElementById('output').select();
            // Execute the "copy" command
            document.execCommand('copy');
            // Show tooltip
            var tooltip = document.createElement("span");
            tooltip.innerText = "Copied to clipboard";
            tooltip.style.position = "absolute";
            tooltip.style.top = "10px";
            tooltip.style.right = "40px";
            tooltip.style.backgroundColor = "#50fa7b";
            tooltip.style.color = "#282a36";
            tooltip.style.padding = "5px";
            tooltip.style.borderRadius = "5px";
            tooltip.style.transition = "opacity 0.3s";
            document.getElementById('container').appendChild(tooltip);
            setTimeout(function() {
                tooltip.style.opacity = "0";
            }, 2000);
            setTimeout(function() {
                document.getElementById('container').removeChild(tooltip);
            }, 3000);
        }
    </script>
</body>
</html>
